include('../common/strategy');

function HealerBulb() {
	var enemy = getNearestLeekEnemy();
	var initialEnemy = enemy;
	var me = getLeek();
	var optimizer = Optimizer();
	var summoner = getSummoner();

	debug('life: ' + getLife());
	debug('MP: ' + getMP());
	debug('TP: ' + getTP());

	while (true) {
		resetLogIndent();
		logInfo('');

		var chip = null;
		var shouldTry = optimizer();
		var target = getLife(me) < (getTotalLife(me) / 2) ?
			me :
			summoner;

		if (
			shouldTry() && canFireWithChip(CHIP_VACCINE, target)
		) {
			chip = CHIP_VACCINE;
		} else if (
			shouldTry() && canFireWithChip(CHIP_CURE, target)
		) {
			chip = CHIP_CURE;
		} else if (
			shouldTry() &&
			target === summoner &&
			canFireWithChip(CHIP_DRIP, target)
		) {
			chip = CHIP_DRIP;
		} else if (
			shouldTry() && canFireWithChip(CHIP_BANDAGE, target)
		) {
			chip = CHIP_BANDAGE;
		} else if (target !== summoner) {
			target = summoner;
			optimizer = Optimizer();
			continue;
		} else if (target !== getNearestAlly()) {
			target = getNearestAlly();
			optimizer = Optimizer();
			continue;
		} else {
			if (getMP() > 0) {
				var targetCell = getCellToDirectFireWithChip(
					CHIP_CURE, summoner
				);
				moveTowardCell(targetCell);
			}
			break;
		}

		if (chip !== null) {
			var result = fire(chip, target);
			var hasError = result[1];

			if (hasError) {
				break;
			}
		}
	}
}
